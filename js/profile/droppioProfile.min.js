$(document).ready(function(){function e(){this.jsonified=[],this.notAllowed=["notAllowed","jsonified","toJSON"],this.bloodType=!1,this.name=!1,this.lastname=!1,this.dni=!1,this.email=!1,this.weight=!1,this.birthDate=!1,this.password=!1,this.province=!1,this.nearbyHospitals=!1,this.toJSON=function(){this.jsonified=[];for(var e in this)void 0!=this[e]&&""!=this[e]&&(this.notAllowed.includes(e)||(this.jsonified[e]=this[e]));return this.jsonified}}function o(e){n.location={lat:e.coords.latitude,lon:e.coords.longitude}}function t(){var e=new google.maps.Geocoder,o=new google.maps.LatLng(n.location.lat,n.location.lon);e.geocode({latLng:o},function(e,o){if(o==google.maps.GeocoderStatus.OK){var t;t=e.length>1?e[1]:e[0],components=t.address_components,console.log(components),n.province=components[components.length-2].long_name}})}var n=new e;navigator.geolocation.watchPosition(function(e){o(e),n.province||t()}),$.post("/registerTest",{_xsrf:xsrf_token,type:"creds"}).done(function(e){if(e=JSON.parse(e),respType=e.type,"creds"==respType){var o=e.dbUser,t=e.dbPass,i=new PouchDB("settings"+o,{auto_compaction:!0,cache:!1,heartbeat:!0}),s=new PouchDB("https://"+o+":"+t+"@alfredarg.com:6489/settings"+o),a=new PouchDB("hospitals",{auto_compaction:!0,cache:!1,heartbeat:!0}),c=new PouchDB("https://"+o+":"+t+"@alfredarg.com:6489/hospitals");$("#saveSettings").submit(function(e){e.preventDefault(),n.name=$("#name").val(),n.lastname=$("#lastname").val(),n.bloodType=$("#bloodType").val(),n.dni=$("#dni").val(),n.email=$("#email").val(),n.birthDate=$("#birthDate").val(),n.weight=$("#weight").val(),n.password=$("#password").val(),n.radius=$("#radius").val(),n.province&&a.find({selector:{province:n.province}}).then(function(e){var o=[],t="docs"in e&&e.docs,s=new google.maps.LatLng(n.location.lat,n.location.lon);if(t){for(var a in t){doc=t[a];var c=new google.maps.LatLng(doc.location.lat,doc.location.lon);distance=google.maps.geometry.spherical.computeDistanceBetween(s,c)/1e3,distance<=n.radius&&o.push(doc.name)}n.nearbyHospitals=o}elems=n.toJSON(),keys=Object.keys(elems),console.log(elems),i.allDocs({include_docs:!0,keys:keys}).then(function(e){e.rows.forEach(function(e){"error"in e?i.put({_id:e.key,value:elems[e.key]}).catch(function(e){}):(doc=e.doc,doc.value=elems[e.key],console.log(doc),i.put(doc).catch(function(e){}))})}).catch(function(e){})})}),i.sync(s,{live:!0,retry:!0,back_off_function:function(e){return 0==e?1e3:e>=1e3&&e<18e5?1.5*e:e>=18e5?1.1*e:void 0}}).on("error",function(e){}),a.sync(c,{live:!0,retry:!0,back_off_function:function(e){return 0==e?1e3:e>=1e3&&e<18e5?1.5*e:e>=18e5?1.1*e:void 0}}).on("error",function(e){})}}),$(".datepicker").datepicker({selectMonths:!0,selectYears:15,today:"Today",clear:"Clear",close:"Ok",closeOnSelect:void 0}),$("select").formSelect()});