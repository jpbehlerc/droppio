$(document).ready(function(){function t(){this._id=!1,this.bloodType=!1,this.name=!1,this.lastname=!1,this.dni=!1,this.hospital=!1,this.hospitalHours=!1,this.duty=!1,this.status=!1,this.createdAt=!1}function n(t){return("0"+t.toString(16)).substr(-2)}function e(t){var e=new Uint8Array((t||40)/2);return window.crypto.getRandomValues(e),Array.from(e,n).join("")}$.fn.extend({animateCss:function(t,n){var e=function(t){var n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var e in n)if(void 0!==t.style[e])return n[e]}(document.createElement("div"));return this.addClass("animated "+t).one(e,function(){$(this).removeClass("animated "+t),"function"==typeof n&&n()}),this}});var o=new t,a={campaigns:!0,settings:!0,hospitals:!1},i={selector:{province:{$exists:!0}}},s={4:[4,8],1:[1,5,4,8],2:[2,6,4,8],3:[1,5,3,7,2,6,4,8],8:[8],5:[5,8],6:[6,8],7:[7,5,6,8]};$.post("/registerTest",{_xsrf:function(t){var n=document.cookie.match("\\b"+t+"=([^;]*)\\b");return!!n&&n[1]}("_xsrf"),type:"creds"}).done(function(t){if(t=JSON.parse(t),respType=t.type,"creds"==respType){var n=t.dbUser,c=t.dbPass,r=new PouchDB("settings"+n,{auto_compaction:!1,cache:!1,heartbeat:!0}),l=new PouchDB("https://"+n+":"+c+"@alfredarg.com:6489/settings"+n),u=new PouchDB("campaigns",{auto_compaction:!0,cache:!1,heartbeat:!0}),d=new PouchDB("https://"+n+":"+c+"@alfredarg.com:6489/campaigns"),p=new PouchDB("hospitals",{auto_compaction:!1,cache:!1,heartbeat:!0}),f=new PouchDB("https://"+n+":"+c+"@alfredarg.com:6489/hospitals");r.sync(l,{live:!0,retry:!0,back_off_function:function(t){return 0==t?1e3:t>=1e3&&t<18e5?1.5*t:t>=18e5?1.1*t:void 0}}).on("paused",function(t){if(a.settings){var n=["name","lastName","bloodType","dni"],e=[];r.allDocs({include_docs:!0,keys:n}).then(function(t){t.rows.forEach(function(t){n.includes(t.id)&&e.push(t.id),"province"==t.id&&(i.selector={province:t.value})}),p.find(i).then(function(t){var n="docs"in t&&t.docs;if(n)for(var e in n)doc=n[e],name=doc.name,$("#hospital").append('<option value="'+name+'">'+name+"</option>");$("#hospital").formSelect()})}),$("#ownCampaign, #othersCampaign").click(function(){n.forEach(function(t){$("#"+t+"Div").css("display","block"),$("#"+t+"Div").animateCss("flipInX")}),"ownCampaign"==$(this).attr("id")&&r.allDocs({include_docs:!0,keys:n}).then(function(t){for(var n in e)$("#"+n+"Div").animateCss("flipOutX",function(){$("#"+n+"Div").css("display","none")})}).catch(function(t){})}),a.settings=!1}}).on("error",function(t){}),p.sync(f,{live:!0,retry:!0,back_off_function:function(t){return 0==t?1e3:t>=1e3&&t<18e5?1.5*t:t>=18e5?1.1*t:void 0}}).on("paused",function(t){}),u.sync(d,{live:!0,retry:!0,back_off_function:function(t){return 0==t?1e3:t>=1e3&&t<18e5?1.5*t:t>=18e5?1.1*t:void 0}}).on("paused",function(t){a.campaigns&&$("#createCampaign").submit(function(t){t.preventDefault(),name=$("#name").val(),lastname=$("#lastname").val(),bloodType=$("#bloodType").val(),dni=$("#dni").val(),status=$("#status").val(),hospital=$("#hospital").val(),hospitalStarts=$("#hospitalHoursStart").val(),hospitalEnds=$("#hospitalHoursEnd").val(),hospitalHours=hospitalStarts+" "+hospitalEnds,o.name=name,o.lastname=lastname,o.bloodType=bloodType,o.dni=dni,o.status=status,o.hospital=hospital,o.hospitalHours=hospitalHours,o.createdAt=moment().tz("America/Argentina/Buenos_Aires").valueOf(),o._id=n+e(16),o.compatible=s[o.bloodType],u.find({selector:{dni:o.dni}}).then(function(t){console.log(t),doc=!!t.docs.length&&t.docs[0],doc||u.put(o).then(function(){console.log("alles gut!")}).catch(function(){})}).catch(function(t){})}),a.campaigns=!1}).on("error",function(t){})}}),$("#bloodType, #status").formSelect(),$(".datepicker").datepicker({selectMonths:!0,selectYears:15,today:"Today",clear:"Clear",close:"Ok",closeOnSelect:!1}),$(".timepicker").timepicker({defaultTime:"08:00",autoClose:!0,twelvehour:!1,done:"OK",cancel:"Cancelar"})});